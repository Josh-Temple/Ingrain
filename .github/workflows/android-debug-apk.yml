name: Android Debug APK

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]
  workflow_dispatch:
    inputs:
      allow_ephemeral_signing:
        description: "Allow fallback debug signing when DEBUG_KEY* secrets are missing (fresh install only)"
        required: false
        default: false
        type: boolean

jobs:
  build:
    uses: ./.github/workflows/reusable-android-debug-apk.yml
    with:
      app_module: app
      gradle_task: assembleDebug
      java_version: "17"
      artifact_name: ingrain-debug-apk
      artifact_name_ephemeral: ingrain-debug-apk-fresh-install-only
      apk_glob: "**/build/outputs/apk/debug/*.apk"
      allow_ephemeral_signing: ${{ github.event_name == 'workflow_dispatch' && inputs.allow_ephemeral_signing || false }}
      version_name_prefix: "1.0"
    secrets: inherit
